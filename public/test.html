<!DOCTYPE html>
<html>
  <head>

  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="js/site.js" type="text/javascript"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="msapplication-TileColor" content="#2161e0"/>
  <meta name="msapplication-TileImage" content="58f5b71c-e014-451b-a429-3806bed36566.png"/>
  <script type="text/javascript"/>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="application-name" content="doogal.co.uk"/>
  <meta name="msapplication-TileColor" content="#2161e0"/>
  <meta name="msapplication-TileImage" content="58f5b71c-e014-451b-a429-3806bed36566.png"/>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-126386-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
</head>
<body>
  <div class="container">
  <div class="header">
    <div class="headerLinks">
    </div>
      <div class="ads">
      <script type='text/javascript'>
<!--//<![CDATA[
   document.MAX_ct0 ='';
   var m3_u = (location.protocol=='https:'?'https://cas.criteo.com/delivery/ajs.php?':'http://cas.criteo.com/delivery/ajs.php?');
   var m3_r = Math.floor(Math.random()*99999999999);
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("zoneid=90259");document.write("&amp;nodis=1");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));
   if (document.context) document.write ("&context=" + escape(document.context));
   if ((typeof(document.MAX_ct0) != 'undefined') && (document.MAX_ct0.substring(0,4) == 'http')) {
       document.write ("&amp;ct0=" + escape(document.MAX_ct0));
   }
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'></scr"+"ipt>");
//]]>--></script>
      </div>
    </div>
  <div class="Content">
  <h1>RoadTripEscape</h1>
    <div class="left-ads">
      <script type='text/javascript'>
<!--//<![CDATA[
   document.MAX_ct0 ='';
   var m3_u = (location.protocol=='https:'?'https://cas.criteo.com/delivery/ajs.php?':'http://cas.criteo.com/delivery/ajs.php?');
   var m3_r = Math.floor(Math.random()*99999999999);
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("zoneid=89475");document.write("&amp;nodis=1");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));
   if (document.context) document.write ("&context=" + escape(document.context));
   if ((typeof(document.MAX_ct0) != 'undefined') && (document.MAX_ct0.substring(0,4) == 'http')) {
       document.write ("&amp;ct0=" + escape(document.MAX_ct0));
   }
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'></scr"+"ipt>");
//]]>--></script>
    </div>
    <div class="realContent">

  <p>Use this page to get directions for routes with multiple waypoints and optimise the routes or to
  see how to implement this kind of functionality yourself.</p>
  <p>To add locations to the route either click on the map or
  enter an address in the field below,
  then use the options below to generate the route and optimise it.</p>

  <div id="map" style="width: 780px; height: 600px;">
    <span style="color:Gray;">Loading map...</span>
  </div>
  <br/>
  <div>
    <h3>Locations</h3>
    Type in an address or click on the map to add a location
    <div>
      <input type="text" id="location" style="width:400px;" />
      <input type="button" onclick="AddLocation()" value="Add location"/><br/>
      <label>Latitude: <input type="text" id="lat" style="width:100px;" /></label>
      <label>Longitude: <input type="text" id="lng" style="width:100px;" /></label>
      <input type="button" onclick="AddLatLng()" value="Add lat/lng"/>
    </div>
    <table id="locations" style="width:100%;">
      <thead>
        <tr>
          <th style="text-align:left;">Location</th>
          <th style="text-align:left;">Latitude</th>
          <th style="text-align:left;">Longitude</th>
          <th style="text-align:left;">Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="4">Your Destinations</td>
        </tr>
      </tbody>
    </table>

    <h3>Routing options</h3>
    <table>
      <tr>
        <td>
          <input type="button" onclick="ClearPolyLine()" value="Clear"/>
        </td>
        <td>Removes all locations from the map</td>
        <td>
          <label for="routeType">Travelling by</label>
          <select id="routeType">
            <option selected="selected">Driving</option>
            <option>Walking</option>
            <option>Public transport</option>
            <option>Cycling</option>
          </select>
        </td>
        <td></td>
      </tr>
    </table>
    <input type="button" onclick="GetDirections()" value="Get directions"/><br/>
    <span id="distance"></span> <span id="duration"></span>
  </div>
  <div id="directions">
  </div>

  <script src="http://maps.google.com/maps/api/js?libraries=places&amp;sensor=false" type="text/javascript"></script>
  <script src="http://www.google.com/uds/api?file=uds.js&amp;v=1.0&amp;key=ABQIAAAAjtZCgAx5i04BiZDO6HlxhRQUdBDpWCOMRMbgTcqadX0jQ8HOERSxXxhk24TIBUpivovAKLrnpSio9w"
  type="text/javascript"></script>
  <script type="text/javascript">
    /* <![CDATA[ */
      var latlng = new google.maps.LatLng(37.7750, -122.4183);
      var options = {
        zoom: 11,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
      };

      var locationsAdded = 1;
      var map = new google.maps.Map(document.getElementById("map"), options);
      var points = [];
      var markers = [];
      google.maps.event.addListener(map,"click", function(location) {
        GetLocationInfo(location.latLng, "Location " + locationsAdded);
        locationsAdded++;
      });
      var directionsDisplay = new google.maps.DirectionsRenderer();

      // autocomplete
      var autocomplete = new google.maps.places.Autocomplete(document.getElementById('location'), {});
      google.maps.event.addListener(autocomplete, 'place_changed', function() {
        var place = autocomplete.getPlace();
        GetLocationInfo(place.geometry.location, $('#location').val());
        map.setCenter(place.geometry.location);
        $("#location").val("");
      });

      function AddLatLng() {
        var latLong = new google.maps.LatLng($('#lat').val(), $('#lng').val());
        GetLocationInfo(latLong, "Location " + locationsAdded);
        locationsAdded++;
        map.setCenter(latLong);
        $("#lat").val("");
        $("#lng").val("");
      }

      function AddLocation(){
        var localSearch = new GlocalSearch();
        localSearch.setSearchCompleteCallback(null,
          function() {
            if (localSearch.results[0]) {
              var results = localSearch.results[0];
              var latLong = new google.maps.LatLng(results.lat, results.lng);

              GetLocationInfo(latLong, $('#location').val());
              map.setCenter(latLong);
              $("#location").val("");
            }
            else {
              alert("Location not found");
            }
          });

        localSearch.execute(document.getElementById("location").value);
      }

      function GetLocationInfo(latlng, locationName) {
        if (latlng != null) {
          var point = { LatLng: latlng, LocationName: locationName };
          points.push(point);
          BuildPoints();
        }
      }

      function clearMarkers(){
        for (var i=0; i<markers.length; i++) {
          markers[i].setMap(null);
        }
        markers = [];
      }

      function BuildPoints() {
        clearMarkers();

        var html = "";

        for (var i=0; i<points.length; i++) {
          var marker = new google.maps.Marker({position: points[i].LatLng, title : points[i].LocationName});
          markers.push(marker);
          marker.setMap(map);

          html += "<tr><td>" + points[i].LocationName + "</td><td>" + roundNumber(points[i].LatLng.lat(), 6) + "</td><td>" +
            roundNumber(points[i].LatLng.lng(), 6) + '</td><td><button onclick="removeRow(' + i + ');" /></td></tr>';
        }

        $("#locations tbody").html(html);

        $( "button" ).button({
          icons: { primary: "ui-icon-trash" },
          text: false
        });
      }

      function ClearPolyLine() {
        points = [];
        BuildPoints();
        ClearRouteDetails();
      }

      function ClearRouteDetails() {
        directionsDisplay.setMap(null);
        directionsDisplay.setPanel(null);
        $("#distance").html("");
        $("#duration").html("");
      }

      function removeRow(index) {
        points.splice(index, 1);
        BuildPoints();
        ClearRouteDetails();
      }

      function GetDirections() {
        var directionsDiv = document.getElementById("directions");
        directionsDiv.innerHTML = "Loading...";

        var directions = new google.maps.DirectionsService();
        directionsDisplay.setMap(map);
        directionsDisplay.setPanel(directionsDiv);

        // build array of waypoints (excluding start and end)
        var waypts = [];
        var end = points.length-1;
        var dest = points[end].LatLng;
        if (document.getElementById("roundTrip").checked) {
          end = points.length;
          dest = points[0].LatLng;
        }
        for (var i=1; i<end; i++) {
          waypts.push({location:points[i].LatLng});
        }

        var routeType = $('#routeType').val();
        var travelMode = google.maps.DirectionsTravelMode.DRIVING;
        if (routeType == "Walking")
          travelMode = google.maps.DirectionsTravelMode.WALKING;
        else if (routeType == "Public transport")
          travelMode = google.maps.DirectionsTravelMode.TRANSIT;
        else if (routeType == "Cycling")
          travelMode = google.maps.DirectionsTravelMode.BICYCLING;

        var optimiseRoute = document.getElementById("optimise").checked;
        var request = {
          origin: points[0].LatLng,
          destination: dest,
          waypoints: waypts,
          travelMode: travelMode,
          optimizeWaypoints: optimiseRoute
        };
        directions.route(request, function(result, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            directionsDiv.innerHTML = "";
            directionsDisplay.setDirections(result);

            // calculate total distance and duration
            var distance = 0;
            var time = 0;
            var theRoute = result.routes[0];
            for (var i=0; i<theRoute.legs.length; i++) {
              var theLeg = theRoute.legs[i];
              distance += theLeg.distance.value;
              time += theLeg.duration.value;
            }
            $("#distance").html("Total distance: " + showDistance(distance) + ", ");
            $("#duration").html("total duration: " + Math.round(time/60) + " minutes");
          }
          else {
            var statusText = getDirectionStatusText(status);
            directionsDiv.innerHTML = "An error occurred - " + statusText;
          }
        });
      }
    /* ]]> */
  </script>

 <br />
 <br />

  <div class="ads">
    <span>
      <script type="text/javascript"><!--
google_ad_client = "pub-3374089704310222";
/* Footer */
google_ad_slot = "2376601151";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </span>
 </div>




 <br />
 <br />
 </div>
 <div class="Footer">
 &copy; Product of PRISM Incs LLC 2013 ©

 </div>
 </div>
 </div>
 </body>
 </html>